<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>报名</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
   		<meta name="format-detection" content="telephone=no">
   		<link rel="stylesheet" href="css/common.css" />
		<link rel="stylesheet" href="css/heavyBuyer.css" />
	</head>
	<body>
		<header>
			<div class="returnAndSave">
				<i></i>
				<span>报名</span>	
			</div>
		</header>
		<section>
			<div class="listMessage">
				<ul>
					<li>
						<label>姓</label>
						<input type="text" class="surName" />
					</li>
					<li>
						<label>名</label>
						<input type="text" class="name" />
					</li>
					<li>
						<label>手机</label>
						<input type="text" class="telphone" maxlength="11" />
					</li>
					<li>
						<label>邮箱</label>
						<input type="text" class="email" />
					</li>
				</ul>
			</div>
			<div class="payForCase">
				<a class="btnPayment">去付款</a>
			</div>
		</section>
		<!-- 弹出层 -->
		<div class="dialog"></div>
	</body>
	<script type="text/javascript" src="js/jquery-1.10.2.js" ></script>
	<script type="text/javascript" src="js/rem(750).js" ></script>
	<script>
		//获取URL地址参数
	    function GetQueryString(name){
	         var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	         var r = window.location.search.substr(1).match(reg);
	         if(r!=null)return  unescape(r[2]); return null;
	    }
		
		$(function(){
			/* 手机号只能输入数字 */
			$(document).on("input",".telphone",function(){
				$(this).val($(this).val().replace(/[^\d]/g,''));
			});
			$(".surName").focus(function(){
				$(".surName").css('border-bottom-color','#000');
			});
			$(".name").focus(function(){
				$(".name").css('border-bottom-color','#000');
			});
			$(".telphone").focus(function(){
				$(".telphone").css('border-bottom-color','#000');
			});
			$(".email").focus(function(){
				$(".email").css('border-bottom-color','#000');
			});
			
			$(".btnPayment").click(function(){
				var surName = $(".surName").val();
				var name = $(".name").val();
				var telphone = $(".telphone").val();
				var email = $(".email").val();
				var eventId = GetQueryString("eventId");
				var weChatToken = GetQueryString("weChatToken");
				var pattern = /^[1][3,4,5,7,8][0-9]{9}$/;
				var patternEmail = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
				if(surName == null || surName == ""){
					$(".surName").css('border-bottom-color','red');
					$(".dialog").html();
					$(".dialog").show();
					$(".dialog").html("姓不能为空");
					setTimeout(function(){
						$(".dialog").hide();
					},2000);
					return;
				}
				if(name == null || name == ""){
					$(".name").css('border-bottom-color','red');
					$(".dialog").html();
					$(".dialog").show();
					$(".dialog").html("名不能为空");
					setTimeout(function(){
						$(".dialog").hide();
					},2000);
					return;
				}
				if(telphone == null || telphone == ""){
					$(".telphone").css('border-bottom-color','red');
					$(".dialog").html();
					$(".dialog").show();
					$(".dialog").html("手机号不能为空");
					setTimeout(function(){
						$(".dialog").hide();
					},2000);
					return;
				}	
				if(!pattern.test(telphone)){
					$(".telphone").css('border-bottom-color','red');
					$(".dialog").html();
					$(".dialog").show();
					$(".dialog").html("手机号格式不正确");
					setTimeout(function(){
						$(".dialog").hide();
					},2000);
					return;
				}
				if(email == null || email == ""){
					$(".email").css('border-bottom-color','red');
					$(".dialog").html();
					$(".dialog").show();
					$(".dialog").html("邮箱不能为空");
					setTimeout(function(){
						$(".dialog").hide();
					},2000);
					return;
				}
				if(!patternEmail.test(email)){
					$(".email").css('border-bottom-color','red');
					$(".dialog").html();
					$(".dialog").show();
					$(".dialog").html("邮箱格式不正确");
					setTimeout(function(){
						$(".dialog").hide();
					},2000);
					return;
				}
				
				$.ajax({
					type:"post",
					url:"/admin/appEvents/signUpEventByPublicNum",
					data:{
						eventId:eventId,
						weChatToken:weChatToken,
						firstname:surName,
						lastname:name,
						telephone:telphone,
						email:email
					},
					dataType : "json",
					async:true,
					success:function(data){
						if(200 == data.status){
							window.location.href='/appmobileus/payment.html'
						}
					}
				}); 
			});
		})
		
	</script>
</html>
